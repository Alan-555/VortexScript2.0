Add option to access variables from higher scopes
add undefined support